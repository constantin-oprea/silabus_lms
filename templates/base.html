{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SilabusLMS | see.think.wonder.</title>
    <link
      rel="icon"
      type="image/png"
      href="{% static 'images/favicon_silabusLMS_official.png' %}"
    />

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Josefin+Sans:wght@300;400;600&family=Playfair+Display:wght@600;700&family=Cinzel:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Global Styles -->
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}" />
    <link rel="stylesheet" href="{% static 'css/calendar.css' %}?v=99" />
    <link rel="stylesheet" href="{% static 'css/dashboard-new.css' %}" />

    {% block head_extra %}{% endblock %}
  </head>

  <body class="{% block body_class %}{% endblock %}">
    <!-- TOP NAVIGATION BAR -->
    <header class="app-header">
      <div class="app-header-left">
        <!-- Hamburger Menu Toggle -->
        <button
          type="button"
          class="hamburger-btn"
          id="sidebarToggle"
          aria-label="Toggle sidebar"
          aria-expanded="true"
        >
          <i class="fas fa-bars"></i>
        </button>
        <!-- Logo in Top Navbar -->
        <a href="{% url 'dashboard:dashboard' %}" class="header-logo">
          <img
            src="{% static 'images/silabusLMS_official_logo.jpg' %}"
            alt="SilabusLMS: see.think.wonder"
            class="header-logo-img"
          />
        </a>
      </div>
      <div class="app-header-right">
        <!-- Notifications Bell -->
        <div class="notification-wrapper" id="notificationWrapper">
          <button
            type="button"
            class="nav-icon-btn"
            id="notificationBtn"
            aria-label="Notifications"
            style="opacity: 1; visibility: visible; display: flex"
          >
            <i class="fas fa-bell"></i>
          </button>
          <span class="notification-badge" id="notificationBadge"></span>
          <div class="notification-dropdown" id="notificationDropdown">
            <div class="notification-dropdown-header">
              <h4>Notifications</h4>
              <button type="button" class="mark-all-read" id="markAllRead">
                Mark all read
              </button>
            </div>
            <div class="notification-list" id="notificationList">
              <!-- Rendered by JS -->
            </div>
          </div>
        </div>

        <!-- Date: DD/MMM/YYYY -->
        <span class="nav-date" id="navDate">02/Jan/2026</span>

        <!-- Time: HH:mm (24h) -->
        <span class="nav-time" id="navTime">02:55</span>

        <!-- User Profile Avatar -->
        <div class="user-profile-nav" id="userProfileNav">
          <button
            type="button"
            class="profile-trigger"
            id="profileTrigger"
            aria-label="User profile menu"
          >
            <img
              src="{% static 'images/admin_user.jpg' %}"
              class="nav-avatar"
              alt="User avatar"
            />
          </button>
          <!-- Dropdown Menu -->
          <div class="profile-dropdown" id="profileDropdown">
            <a href="{% url 'settings_app:settings' %}" class="dropdown-item">
              <i class="fas fa-cog"></i> Settings
            </a>
            <div class="dropdown-divider"></div>
            <a href="{% url 'core:logout' %}" class="dropdown-item">
              <i class="fas fa-sign-out-alt"></i> Logout
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- 3-COLUMN LAYOUT -->
    <div class="app-layout" id="appLayout">
      <!-- LEFT SIDEBAR - Navigation + Top 10 Students -->
      <aside class="left-sidebar" id="leftSidebar">
        {% include 'components/_sidebar.html' %}
      </aside>

      <!-- CENTER CONTENT - DYNAMIC (Expands when sidebar collapsed) -->
      <main class="main-content" id="mainContent">
        {% block content %} {% endblock %}
      </main>

      <!-- RIGHT SIDEBAR - Calendar and Upcoming Events -->
      <aside class="right-panel" id="rightPanel">
        {% include 'components/_right_panel.html' %}
      </aside>
    </div>

    <!-- Data for JavaScript -->
    <script id="topStudentsData" type="application/json">
      {{ top_students_json|safe }}
    </script>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom JS -->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/dashboard-new.js' %}"></script>

    <!-- Sidebar Toggle & DateTime Script -->
    <script>
      // Sidebar Toggle with Collapse
      document
        .getElementById("sidebarToggle")
        ?.addEventListener("click", function () {
          const sidebar = document.getElementById("leftSidebar");
          const mainContent = document.getElementById("mainContent");
          const appLayout = document.getElementById("appLayout");

          sidebar.classList.toggle("collapsed");
          appLayout.classList.toggle("sidebar-collapsed");
          this.setAttribute(
            "aria-expanded",
            !sidebar.classList.contains("collapsed")
          );
        });

      // Update Date/Time in navbar (DD/MMM/YYYY and HH:mm format)
      function updateNavDateTime() {
        const now = new Date();
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        const day = String(now.getDate()).padStart(2, "0");
        const month = months[now.getMonth()];
        const year = now.getFullYear();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");

        const dateEl = document.getElementById("navDate");
        const timeEl = document.getElementById("navTime");

        if (dateEl) dateEl.textContent = `${day}/${month}/${year}`;
        if (timeEl) timeEl.textContent = `${hours}:${minutes}`;
      }

      // Update every minute
      updateNavDateTime();
      setInterval(updateNavDateTime, 60000);

      // Close sidebar when clicking outside on mobile
      document.addEventListener("click", function (e) {
        const sidebar = document.getElementById("leftSidebar");
        const toggle = document.getElementById("sidebarToggle");
        if (
          window.innerWidth <= 992 &&
          !sidebar.classList.contains("collapsed") &&
          !sidebar.contains(e.target) &&
          !toggle.contains(e.target)
        ) {
          sidebar.classList.add("collapsed");
          document
            .getElementById("appLayout")
            .classList.add("sidebar-collapsed");
          toggle.setAttribute("aria-expanded", "false");
        }
      });
    </script>
  </body>
</html>
