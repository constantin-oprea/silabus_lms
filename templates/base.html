{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SilabusLMS | see.think.wonder.</title>
    <link
      rel="icon"
      type="image/png"
      href="{% static 'images/favicon_silabusLMS_official.png' %}"
    />

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Josefin+Sans:wght@300;400;600&family=Playfair+Display:wght@600;700&family=Cinzel:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Global Styles -->
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}" />
    <link rel="stylesheet" href="{% static 'css/calendar.css' %}?v=99" />
    <link rel="stylesheet" href="{% static 'css/dashboard-new.css' %}" />
    <link rel="stylesheet" href="{% static 'css/dashboard-hybrid.css' %}" />

    <!-- MY LAYOUT Styles -->
    <link rel="stylesheet" href="{% static 'css/my-layout-main.css' %}" />
    <link rel="stylesheet" href="{% static 'css/my-layout-sidebar.css' %}?v=2" />
    <link
      rel="stylesheet"
      href="{% static 'css/my-layout-right-panel.css' %}"
    />

    <!-- D3.js v7 for Analytics Visualizations -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Mock Data for My Layout -->
    <script src="{% static 'js/mockData.js' %}"></script>

    {% block head_extra %}{% endblock %}
  </head>

  <body class="{% block body_class %}{% endblock %}">
    <!-- TOP NAVIGATION BAR -->
    <header class="app-header">
      <!-- Logo (Left) -->
      <div class="app-header-left" style="visibility: hidden">
        <!-- Hamburger/Waffle Menu Button -->
        <button
          type="button"
          class="hamburger-btn"
          id="sidebarToggle"
          aria-label="Toggle sidebar"
          aria-expanded="true"
        >
          <i class="bi bi-list"></i>
        </button>
        <img
          src="{% static 'images/silabus_logo_full.png' %}"
          alt="SilabusLMS"
          class="header-logo-img-main"
        />
      </div>

      <!-- Info (Right) -->
      <div class="app-header-right">
        <!-- Session Info (dynamic - populated by JS) -->
        <div
          class="session-info-container"
          id="headerSessionInfo"
          style="display: none"
        >
          <span class="session-label">Your next session starts in</span>
          <span class="session-highlight" id="headerSessionMinutes">--</span>
          <span class="session-divider">|</span>
          <span class="session-details" id="headerSessionDetails">--</span>
        </div>

        <!-- Date/Time Block -->
        <div class="datetime-block">
          <span class="nav-date" id="navDate">04/Jan/2026</span>
          <span class="nav-time" id="navTime">04:48</span>
        </div>

        <!-- User Profile Avatar -->
        <div class="user-profile-nav" id="userProfileNav">
          <button
            type="button"
            class="profile-trigger"
            id="profileTrigger"
            aria-label="User profile menu"
          >
            <img
              src="{% static 'images/admin_user.jpg' %}"
              class="nav-avatar"
              alt="User avatar"
            />
          </button>
          <!-- Dropdown Menu -->
          <div class="profile-dropdown" id="profileDropdown">
            <a href="{% url 'settings_app:settings' %}" class="dropdown-item">
              <i class="fas fa-cog"></i> Settings
            </a>
            <div class="dropdown-divider"></div>
            <a href="{% url 'core:logout' %}" class="dropdown-item">
              <i class="fas fa-sign-out-alt"></i> Logout
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- MY LAYOUT STRUCTURE -->
    <div class="my-layout-container">
      <!-- FIXED LEFT SIDEBAR (No Hamburger) -->
      {% include 'components/_my_layout_sidebar.html' %}

      <!-- MAIN CONTENT AREA -->
      <main class="my-layout-main-content">
        {% block content %} {% endblock %}
      </main>

      <!-- RIGHT SIDE PANEL (Collapsible) -->
      {% include 'components/_my_layout_right_panel.html' %}
    </div>

    <!-- Data for JavaScript -->
    <script id="topStudentsData" type="application/json">
      {{ top_students_json|safe }}
    </script>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom JS -->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/dashboard-new.js' %}"></script>
    <script src="{% static 'js/sidebar-split.js' %}"></script>
    <script src="{% static 'js/my-layout-right-panel.js' %}"></script>

    <!-- Sidebar Toggle & DateTime Script -->
    <script>
      // Sidebar Toggle with Collapse
      document
        .getElementById("sidebarToggle")
        ?.addEventListener("click", function () {
          const sidebar = document.getElementById("leftSidebar");
          const mainContent = document.getElementById("mainContent");
          const appLayout = document.getElementById("appLayout");

          sidebar.classList.toggle("collapsed");
          appLayout.classList.toggle("sidebar-collapsed");
          this.setAttribute(
            "aria-expanded",
            !sidebar.classList.contains("collapsed")
          );
        });

      // Update Date/Time in navbar (DD/MMM/YYYY and HH:mm format)
      function updateNavDateTime() {
        const now = new Date();
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        const day = String(now.getDate()).padStart(2, "0");
        const month = months[now.getMonth()];
        const year = now.getFullYear();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");

        const dateEl = document.getElementById("navDate");
        const timeEl = document.getElementById("navTime");

        if (dateEl) dateEl.textContent = `${day}/${month}/${year}`;
        if (timeEl) timeEl.textContent = `${hours}:${minutes}`;
      }

      // Update every minute
      updateNavDateTime();
      setInterval(updateNavDateTime, 60000);

      // Close sidebar when clicking outside on mobile
      document.addEventListener("click", function (e) {
        const sidebar = document.getElementById("leftSidebar");
        const toggle = document.getElementById("sidebarToggle");
        if (
          window.innerWidth <= 992 &&
          !sidebar.classList.contains("collapsed") &&
          !sidebar.contains(e.target) &&
          !toggle.contains(e.target)
        ) {
          sidebar.classList.add("collapsed");
          document
            .getElementById("appLayout")
            .classList.add("sidebar-collapsed");
          toggle.setAttribute("aria-expanded", "false");
        }
      });
    </script>
  </body>
</html>
