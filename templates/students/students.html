{% extends "base.html" %}

{% load static %}

{% block body_class %}students-page{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/students-new.css' %}?v=3">
<!-- Chart.js for charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<!-- STUDENTS PAGE - COMPACT SPLIT VIEW -->
<div class="students-layout-wrapper">
    
    <!-- LEFT PANEL: Student Directory -->
    <div class="directory-panel">
        <div class="directory-header">
            <h2>Student List</h2>
            <div class="filter-controls">
                <div class="filter-group">
                    <label>Course:</label>
                    <select id="courseFilter">
                        <option value="all">All Courses</option>
                        {% for group in groups %}
                            <option value="{{ group.name }}">{{ group.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- Sort is visual only for now or client-side -->
                <div class="filter-group">
                    <label>Sort By:</label>
                    <select id="sortFilter">
                        <option value="name_asc">Name A-Z</option>
                        <option value="name_desc">Name Z-A</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="student-list-virtual-container" id="virtualScrollContainer">
            <div class="virtual-scroll-spacer" id="virtualSpacer"></div>
            <div class="student-list-content" id="studentListContent">
                <!-- Javascript will inject items here -->
            </div>
        </div>
    </div>

    <!-- RIGHT PANEL: Student Profile Details -->
    <div class="profile-panel" id="profilePanel">
        <!-- HEADER CARD -->
        <div class="profile-header-card">
            <div class="header-content">
                <div class="header-avatar-section">
                    <img src="" id="pAvatar" alt="Student" class="profile-avatar-lg">
                </div>
                <div class="header-info-section">
                    <div class="header-top-row">
                        <h1 id="pName">Student Name</h1>
                        <button class="btn-edit-profile"><i class="fas fa-pencil-alt"></i> Edit Profile</button>
                    </div>
                    <div class="header-sub-row">
                        <span class="header-course" id="pCourse">Course: --</span>
                    </div>
                    <div class="header-grade-row">
                        <span class="grade-label">Average Grade:</span>
                        <span class="grade-value" id="pAvg">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENT GRID -->
        <div class="profile-content-grid">
            
            <!-- LEFT COLUMN: Bio & Activity -->
            <div class="profile-col-left">
                <!-- BIO & INTERESTS -->
                <div class="profile-card bio-card">
                    <div class="card-header-row">
                        <h3>Bio & Interests</h3>
                    </div>
                    <div class="bio-grid">
                        <div class="bio-item">
                            <label>Date of Birth</label>
                            <div id="pDob">--</div>
                        </div>
                        <div class="bio-item">
                            <label>Tutor</label>
                            <div id="pTutor">--</div>
                        </div>
                    </div>
                    <div class="bio-item interests-section">
                        <label>I Like To...</label>
                        <div class="tags-container" id="pInterests">
                            <!-- Tags injected via JS -->
                        </div>
                    </div>
                </div>

                <!-- RECENT ACTIVITY -->
                <div class="profile-card activity-card">
                    <h3>Recent Activity</h3>
                    <div class="activity-list" id="pActivity">
                       <!-- JS Injected -->
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: Analytics & Notes -->
            <div class="profile-col-right">
                
                <!-- ACADEMIC OVERVIEW -->
                <div class="profile-card chart-card">
                    <div class="card-header-row">
                        <h3>Academic Overview</h3>
                        <div class="attendance-badge">
                            <span class="att-label">Attendance</span>
                            <span class="att-value" id="pAttendanceRate">--%</span>
                        </div>
                    </div>
                    <div class="chart-container-wrapper">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                    <div class="recent-grades-section">
                        <h4>Recent Grades</h4>
                        <div class="grades-row" id="pRecentGrades">
                            <!-- JS Injected -->
                        </div>
                    </div>
                </div>

                <!-- TEACHER'S NOTES -->
                <div class="profile-card notes-card">
                    <h3>Teacher's Notes</h3>
                    <div class="notes-input-wrapper">
                         <textarea id="pTeacherNotes" placeholder="Add a note about this student..."></textarea>
                    </div>
                    <div class="notes-footer">
                        <span id="notesStatus">Auto-saved</span>
                    </div>
                </div>

            </div>
        </div>
    </div>

</div>

<script>
    const serverStudentsData = {{ students_json| safe }};
</script>
<script src="{% static 'js/students-new.js' %}?v=3"></script>
{% endblock %}